<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Rapport global</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body class="container mt-4 bg-light">

  <h2>üìä Rapport global locatif</h2>

  <!-- Filtre par mois et ann√©e -->
  <form method="get" class="mb-4">
    <label for="mois">Filtrer par mois :</label>
    <select name="mois" id="mois" class="form-select w-auto d-inline-block">
      <option value="">Tous</option>
      {% for i, nom in mois_list %}
        <option value="{{ i }}" {% if mois == i|stringformat:"s" %}selected{% endif %}>{{ nom }}</option>
      {% endfor %}
    </select>
    
    <label for="annee" class="ms-3">Ann√©e :</label>
    <select name="annee" id="annee" class="form-select w-auto d-inline-block">
      <option value="">Ann√©e courante</option>
      <option value="2024" {% if annee == "2024" %}selected{% endif %}>2024</option>
      <option value="2025" {% if annee == "2025" %}selected{% endif %}>2025</option>
      <option value="2026" {% if annee == "2026" %}selected{% endif %}>2026</option>
    </select>
    
    <button type="submit" class="btn btn-primary">Filtrer</button>
  </form>

  <!-- Tableau global -->
  <table class="table table-striped table-bordered mt-3">
    <thead class="table-dark">
      <tr>
        <th>Propri√©taire</th>
        <th>Total loyers</th>
        <th>Total pay√©</th>
        <th>Non pay√©</th>
        <th>Commission</th>
        <th>Total re√ßu</th>
        <th>Locataires non pay√©s</th>
      </tr>
    </thead>
    <tbody>
      {% for item in rapport %}
      <tr>
        <td>{{ item.proprietaire }}</td>
        <td>{{ item.total_loyers|floatformat:2 }} FCFA</td>
        <td>{{ item.total_paye|floatformat:2 }} FCFA</td>
        <td>{{ item.non_paye|floatformat:2 }} FCFA</td>
        <td>{{ item.commission|floatformat:2 }} FCFA</td>
        <td>{{ item.total_recu|floatformat:2 }} FCFA</td> <!-- ‚úÖ CORRIG√â -->
        <td>
          {% if item.locataires_non_payes %}
            {{ item.locataires_non_payes|join:", " }}
          {% else %}
            ‚úÖ Tous ont pay√©
          {% endif %}
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="7" class="text-center">Aucun rapport disponible</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <a href="{% url 'rapport_global_pdf' %}?{% if mois %}mois={{ mois }}{% endif %}{% if annee %}&annee={{ annee }}{% endif %}" class="btn btn-danger mt-3">üìÑ T√©l√©charger en PDF</a>

</body>
</html>