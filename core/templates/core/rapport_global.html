<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Rapport global</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body class="container mt-4 bg-light">

  <h2>ðŸ“Š Rapport global locatif</h2>

  <!-- Filtre par mois -->
  <form method="get" class="mb-4">
    <label for="mois">Filtrer par mois :</label>
    <select name="mois" id="mois" class="form-select w-auto d-inline-block">
      <option value="">Tous</option>
      {% for i, mois in mois_list %}
        <option value="{{ i }}" {% if request.GET.mois == i|stringformat:"s" %}selected{% endif %}>{{ mois }}</option>
      {% endfor %}
    </select>
    <button type="submit" class="btn btn-primary">Filtrer</button>
  </form>

  <!-- Tableau global -->
  <table class="table table-striped table-bordered mt-3">
    <thead class="table-dark">
      <tr>
        <th>PropriÃ©taire</th>
        <th>Total loyers</th>
        <th>Total payÃ©</th>
        <th>Non payÃ©</th>
        <th>Commission</th>
        <th>Locataires non payÃ©s</th>
      </tr>
    </thead>
    <tbody>
      {% for item in rapport %}
      <tr>
        <td>{{ item.proprietaire }}</td>
        <td>{{ item.total_loyers }} FCFA</td>
        <td>{{ item.total_paye }} FCFA</td>
        <td>{{ item.non_paye }} FCFA</td>
        <td>{{ item.commission }} FCFA</td>
        <td>
          {% if item.locataires_non_payes %}
            {{ item.locataires_non_payes|join:", " }}
          {% else %}
            âœ… Tous ont payÃ©
          {% endif %}
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="6" class="text-center">Aucun rapport disponible</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Bouton PDF -->
  <a href="{% url 'rapport_global_pdf' %}" class="btn btn-danger mt-3">ðŸ“„ TÃ©lÃ©charger en PDF</a>

</body>
</html>
