{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h2>Ajouter un paiement</h2>
  <form method="post" class="card p-4 shadow">
    {% csrf_token %}
    
    <!-- Propriétaire -->
    <div class="mb-3">
      <label for="id_proprietaire" class="form-label">Propriétaire</label>
      {{ form.proprietaire }}
    </div>

    <!-- Locataire -->
    <div class="mb-3">
      <label for="id_locataire" class="form-label">Locataire</label>
      <select id="id_locataire" name="locataire" class="form-select">
        <option value="">-- Sélectionnez un locataire --</option>
      </select>
    </div>

    <!-- Date de paiement -->
    <div class="mb-3">
      <label for="id_date_paiement" class="form-label">Date de paiement</label>
      {{ form.date_paiement }}
    </div>

    <!-- Mois concerné -->
    <div class="mb-3">
      <label for="id_mois_concerne" class="form-label">Mois concerné</label>
      {{ form.mois_concerne }}
    </div>

    <!-- Montant -->
    <div class="mb-3">
      <label for="id_montant" class="form-label">Montant</label>
      {{ form.montant }}
    </div>

    <!-- Payé en avance -->
    <div class="form-check mb-3">
      {{ form.paye_en_avance }}
      <label class="form-check-label" for="id_paye_en_avance">Payé en avance</label>
    </div>

    <!-- Bouton -->
    <button type="submit" class="btn btn-primary">Valider</button>
  </form>
</div>

<script>
// Quand on choisit un propriétaire
document.getElementById("id_proprietaire").addEventListener("change", function() {
    const proprietaireId = this.value;
    if (!proprietaireId) return;

    // Charger les locataires du propriétaire
    fetch(`/get-locataires/${proprietaireId}/`)
      .then(response => response.json())
      .then(data => {
        const locataireSelect = document.getElementById("id_locataire");
        locataireSelect.innerHTML = '<option value="">-- Sélectionnez un locataire --</option>';
        data.forEach(loc => {
          const option = document.createElement("option");
          option.value = loc.id;
          option.textContent = loc.nom;
          locataireSelect.appendChild(option);
        });
      });
});

// Quand on choisit un locataire
document.getElementById("id_locataire").addEventListener("change", function() {
    const locataireId = this.value;
    if (!locataireId) return;

    // Charger le loyer du locataire
    fetch(`/get-loyer/${locataireId}/`)
      .then(response => response.json())
      .then(data => {
        if (data.loyer) {
          document.getElementById("id_montant").value = data.loyer;
        }
      });
});
</script>

{% endblock %}
