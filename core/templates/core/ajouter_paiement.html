{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h2>Ajouter un paiement</h2>
  <form method="post" class="card p-4 shadow">
    {% csrf_token %}
    
    <div class="mb-3">
      <label for="id_proprietaire" class="form-label">Propriétaire</label>
      {{ form.proprietaire }}
    </div>

    <div class="mb-3">
      <label for="id_locataire" class="form-label">Locataire</label>
      <select id="id_locataire" name="locataire" class="form-select">
        <option value="">-- Sélectionnez un locataire --</option>
      </select>
    </div>

    <div class="mb-3">
      <label for="id_mois_concerne" class="form-label">Mois concerné</label>
      {{ form.mois_concerne }}
    </div>

    <div class="mb-3">
      <label for="id_montant" class="form-label">Montant</label>
      {{ form.montant }}
    </div>

    <button type="submit" class="btn btn-primary">Valider</button>
  </form>
</div>

<script>
document.getElementById("id_proprietaire").addEventListener("change", function() {
    const proprietaireId = this.value;
    if (!proprietaireId) return;

    fetch(`/get-locataires/${proprietaireId}/`)
      .then(response => response.json())
      .then(data => {
        const locataireSelect = document.getElementById("id_locataire");
        locataireSelect.innerHTML = '<option value="">-- Sélectionnez un locataire --</option>';
        data.forEach(loc => {
          const option = document.createElement("option");
          option.value = loc.id;
          option.textContent = loc.nom;
          locataireSelect.appendChild(option);
        });
      });
});

// ✅ Auto-remplissage du montant du loyer
document.getElementById("id_locataire").addEventListener("change", function() {
    const locataireId = this.value;
    if (!locataireId) return;

    fetch(`/get-loyer/${locataireId}/`)
      .then(response => response.json())
      .then(data => {
        if (data.loyer) {
          document.getElementById("id_montant").value = data.loyer;
        }
      });
});
</script>
{% endblock %}
